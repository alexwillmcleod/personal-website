---
import Picture from 'astro/components/Picture.astro';
import type Article from '../../interfaces/article';
import fetchApi from '../../lib/strapi';
import { Markdown } from '@astropub/md';
import { Image, getImage } from 'astro:assets';
import BaseHead from '../../components/BaseHead.astro';

export async function getStaticPaths() {
  const articles: Article[] = await fetchApi<Article[]>({
    endpoint: 'articles',
    wrappedByKey: 'data'
  });

  return articles.map((article) => ({
    params: {
      slug: article.attributes.slug
    },
    props: article
  }));
	
}
type Props = Article;

const article = Astro.props;

const coverImageURL: string | undefined = article.attributes.image?.data.attributes.url;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <BaseHead />
    <title>{article.attributes.title}</title>
  </head>

  <body>
    <main>
      <!-- <img src={import.meta.env.STRAPI_URL + article.attributes.image.data.attributes.url} /> -->
     
      {coverImageURL && <Picture width={1080} inferSize decoding="async" class="max-w-[720px]" src={coverImageURL} alt={article.attributes.title}/>}
      <h1>{article.attributes.title}</h1>
      <h3>{new Date(article.attributes.publishedAt).toDateString()}</h3>
      <!-- Render markdown -->
      <Markdown of={article.attributes.content} />
    </main>
  </body>
</html>
